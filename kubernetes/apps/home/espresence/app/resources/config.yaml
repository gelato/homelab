# MQTT Connection, if empty will query and use hassio provided mqtt
mqtt:
  host: emqx-listeners
  port: 1883
  ssl: false
  username: ${MOSQUITTO_MQTT_USERNAME}
  password: ${MOSQUITTO_MQTT_PASSWORD}
  discovery_topic: homeassistant  # Home Assistant MQTT discovery topic prefix (default: homeassistant)

ips:
  enabled: true

# This gets added to the x,y,z to derive a gps location
gps:
  latitude: "${SECRET_HOME_LATITUDE}"
  longitude: "${SECRET_HOME_LONGITUDE}"
  elevation: "${SECRET_HOME_ELEVATION}"
  rotation: 90 # Rotation in degrees from north (0 degrees)
  report: true # Include GPS latitude/longitude when reporting to Home Assistant

map:
  flip_x: false        # Set to true to flip X coordinates (default: false)
  flip_y: true         # Set to true to use bottom-left origin, false for top-left origin (default: true)
  wall_thickness: 0.2  # Wall thickness in meters
  wall_color: "#ddd"   # Optional wall color, if not set uses room color
  wall_opacity: 0.35   # Optional wall opacity, if not set defaults to 0.35

# How long before device considered stale
timeout: 60
# How long before device is considered away
away_timeout: 180

# Retain devices for this long since last seen (duration string)
# Examples: "30d", "720h", "2592000s"
device_retention: 30d

optimization:
  enabled: true
  interval_secs: 1200
  keep_snapshot_mins: 15   # How long to keep optimization snapshots (default: 5 minutes)
  optimizer: per_node_absorption # Options global_absorption, per_node_absorption, legacy (default: legacy)
  limits:
    absorption_min: 1
    absorption_max: 5
    rx_adj_rssi_min: -15
    rx_adj_rssi_max: 20
    tx_ref_rssi_min: -70
    tx_ref_rssi_max: -30
  weights:
    # Weighting factor for Pearson Correlation in best scenario scoring (default: 0.5)
    correlation: 0.5
    # Weighting factor for normalized RMSE in best scenario scoring (default: 0.5)
    rmse: 0.5


locators:
  nadaraya_watson:
    enabled: true
    floors: ["first"]
    bandwidth: 0.5
    kernel: gaussian

  nelder_mead:
    enabled: false
    floors: ["first"]
    weighting:
      algorithm: gaussian
      props:
        sigma: 0.10

  nearest_node:
    enabled: true
    max_distance: 10

filtering:
  # Kalman Filter Parameters
  process_noise: 0.01      # Controls how quickly the filter adapts to change. Lower = smoother but more lag.
  measurement_noise: 0.1   # Controls how much new measurements are trusted. Higher = trust model more (smoother).
  max_velocity: 0.5        # Maximum expected velocity in m/s. Used to reject/dampen impossible movements.

  # Smoothing Parameters
  smoothing_weight: 0.7    # Weight given to previous state (0.0-1.0). Higher = more stable/repeatable.
  motion_sigma: 2.0        # Motion consistency sensitivity. Controls how much distant scenarios are penalized.

history:
  enabled: false # Enable to log history to db (Beta)
  expire_after: 24h # Expire after 24 hours

# Floors w/ the points to draw it in meters
floors:
  - id: first
    name: First Floor
    # Bounds (x,y,z) of map in meters
    bounds: [[0, 0, 0], [9.6, 7.2, 2.7]]
    rooms:
      - name: bathroom
        points:
          - [ 1.1, 9.40]
          - [ 2.5, 9.40]
          - [ 2.5, 7.10]
          - [ 1.1, 7.10]
          - [ 1.1, 9.40]
      - name: kitchen
        points:
          - [ 1.2, 7.10]
          - [ 2.5, 7.10]
          - [ 2.5, 3.20]
          - [ 1.2, 3.20]
          - [ 1.2, 7.10]
      - name: guestroom
        points:
          - [ 2.5, 6.40]
          - [ 7.2, 6.40]
          - [ 7.2, 3.2]
          - [ 2.5, 3.2]
          - [ 2.5, 6.40]
      - name: dining
        points:
          - [ 0, 3.2]
          - [ 2.5, 3.2]
          - [ 2.5, 0.7]
          - [ 0, 0.7]
          - [ 0, 3.2]
      - name: bedroom
        points:
          - [ 2.5, 3.2]
          - [ 7.2, 3.2]
          - [ 7.2, 0]
          - [ 2.5, 0]
          - [ 2.5, 3.2]
    # Locations of espresense nodes in meters
nodes:
  - name: kitchen
    room: kitchen
    point: [2.3, 3.5, 1.16]
    floors: ["first"]
  - name: dining
    room: dining
    point: [0.1, 1.8, 0]
    floors: ["first"]
  - name: bedroom
    room: bedroom
    point: [7, 0.2, 0]
    floors: ["first"]
  - name: guestroom
    room: guestroom
    point: [7, 6.3, 0]
    floors: ["first"]
  - name: bedroom-entry
    room: bedroom
    point: [2.6, 2.2, 2.4]
    floors: ["first"]
  - name: bedroom-entry-left
    room: bedroom
    point: [2.6, 3.1, 0.3]
    floors: ["first"]
  - name: guestroom-server
    room: guestroom
    point: [2.6, 5.9, 0.2]
    floors: ["first"]
  - name: guestroom-vlad
    room: guestroom
    point: [6.9, 4, 0]
    floors: ["first"]
  - name: guestroom_entry
    room: guestroom
    point: [3.8, 3.5, 1.5]
    floors: ["first"]
  - name: bedroom-nes
    room: bedroom
    point: [7, 3.1, 0.5]
    floors: ["first"]
  - name: bedroom_closet
    room: bedroom
    point: [2.9, 0.3, 1.5]
    floors: ["first"]
  - name: dining-fridge
    room: dining
    point: [2, 2.2, 1.8]
    floors: ["first"]
  - name: dining_entry
    room: dining
    point: [0, 3, 1.7]
    floors: ["first"]
  - name: bathroom
    room: bathroom
    point: [1.2, 7.7, 1.7]
    floors: ["first"]

# Devices to track
devices:
  - name: "*" # Track all named devices
  - id: "tile:*" # Track all tiles
  - id: "irk:*" # Track all IRKs
  - id: "watch:*"
  - id: "phone:*"
  - id: "wallet:*"
  - id: "keys:*"
  - id: "therm:*"
  - id: "iBeacon:*"
  - id: "car:*"
  - id: "laptop:*"
  - id: "backpack:*"
  - id: "garmin:*"
  - id: "known:*"
  # - id: "apple:*"

# Devices to NOT track
exclude_devices:
  - id: "iBeacon:e5ca1ade-f007-ba11-0000-000000000000-*" # These are junk, we alias them to node:*